<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="">
    <meta name="generator" content="Hugo 0.37" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://EddieAbbondanzio.github.io/css/style.css" type="text/css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" type="text/css">
    <link rel="alternate" href="https://EddieAbbondanzio.github.io/index.xml" type="application/rss+xml" title="Eddie Abbondanzio">

    <title>
        
        Software Design - Contextual Validation  - Eddie Abbondanzio 
    </title>
</head>
    
<body>
    <header>
        <div class="container clearfix">
        
        <a class="path" href="https://EddieAbbondanzio.github.io/">Home</a>

        
        <div class="right">
            
            
            
            
            
            <a class="path" href="/page/about/">About Me</a>
        </div>
      </div>
    </header>

<div class="container">


<main role="main" class="article">
  
<article class="single" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="meta">

    <span class="key">published on</span>
    <span class="val"><time itemprop="datePublished" datetime="2018-10-10">October 10, 2018</time></span>


    <span class="key">in</span>
    <span class="val">

        <a href="https://EddieAbbondanzio.github.io/categories/software-design">Software Design</a>

    </span>


  </div>
  <h1 class="headline" itemprop="headline">Software Design - Contextual Validation</h1>
  <section class="body" itemprop="articleBody" >
    

<h2 id="validating-objects-based-on-context">Validating Objects Based on Context</h2>

<p>It&rsquo;s quite typical for a Domain Driven Design (DDD) project to need validation for it&rsquo;s domain models. While it may be sufficient to solve this by adding an IsValid() method to each model, this can cause confusion for the developer by cluttering the model class, and/or by requiring the IsValid() method to be generalized that it covers a large range of validation rules for any situation that may arise. Let&rsquo;s work with an example.</p>

<p>Imagine there is an User object like so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c#" data-lang="c#">    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span> {
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Username { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Password { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">bool</span> IsDeleted { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }

        <span style="color:#66d9ef">public</span> User(<span style="color:#66d9ef">string</span> username, <span style="color:#66d9ef">string</span> password) {
            Username = username;
            Password = password;
        }
    }</code></pre></div>
<p>We need a way that we can validate users before adding them to the database. This could be achieved by adding the IsValid() method as mentioned earlier.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c#" data-lang="c#">    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span> {
        ...

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">bool</span> IsValid() {
            <span style="color:#66d9ef">if</span>(!<span style="color:#66d9ef">string</span>.IsNullOrEmpty(Username) &amp;&amp; !<span style="color:#66d9ef">string</span>.IsNullOrEmpty(Password)) {
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
            }
            <span style="color:#66d9ef">else</span> {
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
            }
        }
    }</code></pre></div>
<p>This solves the problem by checking that both a Username, and Password have been defined, and if not returns false. However, what do we do when we also need to handle validating that a user hasn&rsquo;t been deleted already before allowing it to be deleted? We could add an IsValidToDelete() method to the class but this is just starting to clutter things, and seems like a pretty bad approach. On the other hand we could simply call IsValid before deleting but then any user we want to delete would have to have a valid username, and password which makes no sense.</p>

<p>To overcome this issue we can introduce the concept of validators. Validators utilize the <a href="https://en.wikipedia.org/wiki/Visitor_pattern">visitor pattern</a> to separate the validaiton logic from the model itself. Let&rsquo;s define an interface for all validators to derive from.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c#" data-lang="c#">    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> IValidator&lt;T&gt; {
        <span style="color:#66d9ef">bool</span> Validate(T entity);
    }</code></pre></div>
<p>Now we can define two validators, one to handle users when created, and another to handle users when deleted.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c#" data-lang="c#">    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserCreationValidator</span> : IValidator&lt;User&gt; {
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">bool</span> Validate(User user) {
            <span style="color:#66d9ef">if</span> (!<span style="color:#66d9ef">string</span>.IsNullOrEmpty(<span style="color:#a6e22e">user</span>.Username) &amp;&amp; !<span style="color:#66d9ef">string</span>.IsNullOrEmpty(<span style="color:#a6e22e">user</span>.Password)) {
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
            }
            <span style="color:#66d9ef">else</span> {
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
            }
        }
    }

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserDeletionValidator</span> : IValidator&lt;User&gt; {
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">bool</span> Validate(User user) {
            <span style="color:#66d9ef">return</span> !<span style="color:#a6e22e">user</span>.IsDeleted;
        }
    }</code></pre></div>
<p>Then in our UserController class we could handle validation like so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c#" data-lang="c#">    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserController</span> {
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">bool</span> AddUser(User user) {
            UserCreationValidator validator = <span style="color:#66d9ef">new</span> UserCreationValidator();

            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">validator</span>.Validate(user)) {
                <span style="color:#75715e">//Add the user
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
            }
            <span style="color:#66d9ef">else</span> {
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
            }
        }

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">bool</span> DeleteUser(User user) {
            UserDeletionValidator validator = <span style="color:#66d9ef">new</span> UserDeletionValidator();

            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">validator</span>.Validate(user)) {
                <span style="color:#75715e">//Delete the user
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
            }
            <span style="color:#66d9ef">else</span> {
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
            }
        }
    }</code></pre></div>
<p>This helps maintain the single role principle for each of our classes, and enables us to handle validating based on context in a way that can scale nicely.</p>

  </section>
</article>

</main>


</div>

<footer style="position: relative; bottom: 0px; width: 100%;">
  <div class="container">
    <span class="copyright">&copy; 2018  Eddie Abbondanzio - <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></span>
  </div>
</footer>

</body>
</html>

